<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Rush Stack Blog</title>
        <link>https://rushstack.io/zh-cn/blog</link>
        <description>Rush Stack Blog</description>
        <lastBuildDate>Fri, 16 Jun 2023 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-cn</language>
        <item>
            <title><![CDATA[Heft 0.51迁移指南]]></title>
            <link>https://rushstack.io/zh-cn/blog/2023/06/16/heft-migration-guide</link>
            <guid>https://rushstack.io/zh-cn/blog/2023/06/16/heft-migration-guide</guid>
            <pubDate>Fri, 16 Jun 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Heft 0.51.0 版本推出了一个带来了一些重大架构变化的"多阶段"特性。如果你一直在使用较旧的版本，那么升级将需要对你的Heft 配置文件以及可能编写的自定义插件进行一些更改。在这篇文章中，我们将总结发生了哪些更改，以及如何迁移你的项目。这可能是在 Heft 的 1.0.0 版本发布之前的最后一次重大破坏性更改。]]></description>
            <content:encoded><![CDATA[<p>Heft <strong>0.51.0</strong> 版本推出了一个带来了一些重大架构变化的"多阶段"特性。如果你一直在使用较旧的版本，那么升级将需要对你的<strong>Heft 配置文件</strong>以及可能编写的<strong>自定义插件</strong>进行一些更改。在这篇文章中，我们将总结发生了哪些更改，以及如何迁移你的项目。这可能是在 Heft 的 1.0.0 版本发布之前的最后一次重大破坏性更改。</p><blockquote><p>想要更深入地了解多阶段设计及其背后的动机，请参阅我们的另一篇文章<a href="/zh-cn/blog/2023/06/15/heft-whats-new/">Heft 0.51 中的新内容</a>。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_abXo" id="版本时间线">版本时间线<a href="#版本时间线" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>虽然大部分的重大更改都在 Heft <strong>0.51.0</strong> 中，但在后续的几个版本中也进行了一些重要的更改：</p><ul><li>Heft <strong>0.51.0</strong>: 为支持多阶段功能做出的大规模架构变更，包括配置文件架构和插件 API 的破坏性更改</li><li>Heft <strong>0.52.0</strong>: 恢复对 <code>heft start</code> 别名的支持（该别名在 0.51.0 版本中被移除）；增加了定义自定义别名的能力；<code>@rushstack/heft-node-rig</code> 现在使用与 <code>@rushstack/heft-web-rig</code> 相同的 <code>heft start</code> 别名启动其开发服务器</li><li>Heft <strong>0.53.0</strong>: 移除了 <code>taskEvents</code> 配置设置；像 <code>copy-files-plugin</code> 和 <code>node-service-plugin</code> 这样的内建任务现在使用与第三方插件相同的配置（简单地指定 <code>@rushstack/heft</code> 为他们的插件包名称）</li><li>Heft <strong>0.54.0</strong>: 恢复了对 <code>heft test -u</code> 中 <code>-u</code> 等短参数名称的支持（该支持在 0.51.0 版本中被移除）</li><li>Heft <strong>0.55.0</strong>: 从插件 API 的会话对象中移除了 <code>cacheFolderPath</code>，因为 <code>.cache</code> 文件夹不再被使用</li></ul><p>为了简化这些迁移说明，在本文中我们将假设你正在升级到 <strong>0.55.0 或更新的版本</strong>，且你的当前版本是 <strong>0.50.x 或更旧的版本</strong>。</p><h2 class="anchor anchorWithStickyNavbar_abXo" id="迁移-heftjson-文件">迁移 heft.json 文件<a href="#迁移-heftjson-文件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_abXo" id="json-schema-url-的更改">JSON Schema URL 的更改<a href="#json-schema-url-的更改" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>为了在编辑配置文件时能得到正确的 VS Code 智能提示，需要更新每个 Heft 配置文件中的 <code>"$schema"</code> 字段。只需将 <code>json-schemas/heft/</code> 替换为 <code>json-schemas/heft/v0</code> 即可。</p><p>例如：</p><ul><li>旧的：<code>"$schema": "https://developer.microsoft.com/json-schemas/heft/heft.schema.json"</code></li><li>新的：<code>"$schema": "https://developer.microsoft.com/json-schemas/heft/v0/heft.schema.json"</code></li></ul><p>完整的 JSON schema 名称列表可以在<a href="https://github.com/microsoft/json-schemas/tree/main/heft/v0" target="_blank" rel="noopener noreferrer">此 GitHub 文件夹</a>中找到。这些名称是上面显示的 URL 的最后一部分。</p><h3 class="anchor anchorWithStickyNavbar_abXo" id="插件必须显式加载">插件必须显式加载<a href="#插件必须显式加载" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在旧的设计中，许多插件被内置于 <code>@rushstack/heft</code> 中，不需要使用 <strong>heft.json</strong> 设置显式加载。如果找不到它们相关的配置文件，那么它们的任务就会被默默地跳过。</p><p><strong>旧的：</strong> 隐式加载的插件：</p><ul><li>heft-typescript-plugin</li><li>copy-static-assets-plugin</li><li>copy-files-plugin</li><li>delete-globs-plugin</li><li>run-script-plugin</li><li>api-extractor-plugin</li><li>project-validator-plugin</li><li>node-service-plugin</li></ul><p><strong>新的：</strong> 迁移后，每个插件必须通过 <strong>heft.json</strong> 配置文件显式加载。通常这是从你的 rig 继承过来的。这种新模型消除了神秘和不确定性，因为插件及其依赖的完整集合现在在配置文件中表示。</p><p>如果你正在使用我们的 <code>@rushstack/heft-node-rig</code> 和 <code>@rushstack/heft-web-rig</code>，你的项目应该只需要做少量的更改，因为更新后的 rigs 现在显式加载所有这些插件。如果你创建了一个自定义的 rig，迁移工作将会更复杂，但你可以从我们的例子中复制：</p><ul><li><a href="https://github.com/microsoft/rushstack/blob/main/rigs/heft-node-rig/profiles/default/config/heft.json" target="_blank" rel="noopener noreferrer">heft-node-rig/profiles/default/config/heft.json</a></li><li><a href="https://github.com/microsoft/rushstack/blob/main/rigs/heft-web-rig/profiles/app/config/heft.json" target="_blank" rel="noopener noreferrer">heft-web-rig/profiles/app/config/heft.json</a></li></ul><h3 class="anchor anchorWithStickyNavbar_abXo" id="迁移-packagejson-依赖">迁移 package.json 依赖<a href="#迁移-packagejson-依赖" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>许多插件已经被提取到它们自己的 NPM 包中。这减少了对某些插件不使用的项目的启动时间和安装占用。</p><p>以下是写作时的当前库存：</p><ul><li><a href="https://github.com/microsoft/rushstack/tree/main/apps/heft" target="_blank" rel="noopener noreferrer">@rushstack/heft</a>：其<a href="https://github.com/microsoft/rushstack/blob/main/apps/heft/heft-plugin.json" target="_blank" rel="noopener noreferrer">heft-plugin.json</a>定义了多个插件 copy-files-plugin、delete-files-plugin、node-service-plugin、run-script-plugin</li><li><a href="https://github.com/microsoft/rushstack/tree/main/heft-plugins/heft-api-extractor-plugin" target="_blank" rel="noopener noreferrer">@rushstack/heft-api-extractor-plugin</a></li><li><a href="https://github.com/microsoft/rushstack/tree/main/heft-plugins/heft-dev-cert-plugin" target="_blank" rel="noopener noreferrer">@rushstack/heft-dev-cert-plugin</a></li><li><a href="https://github.com/microsoft/rushstack/tree/main/heft-plugins/heft-jest-plugin" target="_blank" rel="noopener noreferrer">@rushstack/heft-jest-plugin</a></li><li><a href="https://github.com/microsoft/rushstack/tree/main/heft-plugins/heft-lint-plugin" target="_blank" rel="noopener noreferrer">@rushstack/heft-lint-plugin</a></li><li><a href="https://github.com/microsoft/rushstack/tree/main/heft-plugins/heft-sass-plugin" target="_blank" rel="noopener noreferrer">@rushstack/heft-sass-plugin</a></li><li><a href="https://github.com/microsoft/rushstack/tree/main/heft-plugins/heft-serverless-stack-plugin" target="_blank" rel="noopener noreferrer">@rushstack/heft-serverless-stack-plugin</a></li><li><a href="https://github.com/microsoft/rushstack/tree/main/heft-plugins/heft-storybook-plugin" target="_blank" rel="noopener noreferrer">@rushstack/heft-storybook-plugin</a></li><li><a href="https://github.com/microsoft/rushstack/tree/main/heft-plugins/heft-typescript-plugin" target="_blank" rel="noopener noreferrer">@rushstack/heft-typescript-plugin</a></li><li><a href="https://github.com/microsoft/rushstack/tree/main/heft-plugins/heft-webpack4-plugin" target="_blank" rel="noopener noreferrer">@rushstack/heft-webpack4-plugin</a></li><li><a href="https://github.com/microsoft/rushstack/tree/main/heft-plugins/heft-webpack5-plugin" target="_blank" rel="noopener noreferrer">@rushstack/heft-webpack5-plugin</a></li></ul><h3 class="anchor anchorWithStickyNavbar_abXo" id="迁移独立的-heftjson">迁移独立的 heft.json<a href="#迁移独立的-heftjson" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>旧的 <strong>heft.json</strong> 区分了"事件动作"（即内置任务）和"heftPlugins"（即来自插件包的任务）。</p><p><strong>旧的：</strong> <code>heft-node-rig</code> 中的 <strong>heft.json</strong> 摘录</p><div class="language-ts codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-ts codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ⚠️ 旧格式示例 -- 请勿使用！⚠️</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://developer.microsoft.com/json-schemas/heft/heft.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// "deleteGlobs" 指定在 "clean" 事件下运行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"eventActions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 📌 [1] 旧的清理方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"actionKind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"deleteGlobs"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"heftEvent"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"clean"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"actionId"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"defaultClean"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"globsToDelete"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"dist"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"lib"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"lib-commonjs"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"temp"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Jest 插件使用 "heftPlugins" 部分加载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 并且它的事件序列是使用程序逻辑定义的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"heftPlugins"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 📌 [2] 旧的加载插件方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"plugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-jest-plugin"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>新的：</strong> <code>heft-node-rig</code> 中的 <strong>heft.json</strong> 摘录</p><div class="language-ts codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-ts codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://developer.microsoft.com/json-schemas/heft/v0/heft.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"phasesByName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ("build" 是用户定义的名称，不是模式字段)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"build"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 📌 [1] 新的清理方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"cleanFiles"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"sourcePath"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dist"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"sourcePath"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"lib"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"sourcePath"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"lib-commonjs"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"tasksByName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ("typescript" 是用户定义的名称，不是模式字段)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"typescript"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-typescript-plugin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"lint"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"typescript"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-lint-plugin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"api-extractor"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"typescript"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-api-extractor-plugin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"node-service"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"typescript"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 这个内置插件指定 "@rushstack/heft" 作为它的包名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"node-service-plugin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ("test" 是用户定义的名称，不是模式字段)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"test"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"phaseDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"build"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"tasksByName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ("jest" 是用户定义的任务名称)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"jest"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// 📌 [2] 新的加载插件方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-jest-plugin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>观察上面的示例，主要的更改有：</p><ul><li>每个任务必须从 <code>pluginPackage</code> 中显式加载，因此 rig 的 <strong>heft.json</strong> 现在更冗长（但更易理解！）</li><li>内置任务（例如 <code>node-service</code>）与外部插件具有相同的规范</li><li>旧的 <code>"heftEvent"</code> 生命周期已被 <code>phaseDependencies</code> 和 <code>taskDependencies</code> 取代，其依赖图确定了任务的顺序</li></ul><p>完整的配置文件可以在这里找到：<a href="https://github.com/microsoft/rushstack/blob/main/rigs/heft-node-rig/profiles/default/config/heft.json" target="_blank" rel="noopener noreferrer">heft-node-rig/profiles/default/config/heft.json</a></p><h3 class="anchor anchorWithStickyNavbar_abXo" id="迁移已配置的-heftjson">迁移已配置的 heft.json<a href="#迁移已配置的-heftjson" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>这是来自<a href="https://tsdoc.org/play/" target="_blank" rel="noopener noreferrer">TSDoc Playground</a>项目的另一个示例，它的 <a href="https://github.com/microsoft/tsdoc/blob/main/playground/config/heft.json" target="_blank" rel="noopener noreferrer">heft.json</a> 继承自我们的 <code>heft-web-rig</code>：</p><p><strong>旧的：</strong> <code>playground/config/heft.json</code> 中的 <strong>heft.json</strong> 摘录</p><div class="language-ts codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-ts codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ⚠️ 旧格式示例 -- 请勿使用！⚠️</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://developer.microsoft.com/json-schemas/heft/heft.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"extends"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-web-rig/profiles/library/config/heft.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"eventActions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"actionId"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"copyLicenseToDistFolder"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"actionKind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"copyFiles"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 📌 [3] 旧的编译后操作方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"heftEvent"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"compile"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"copyOperations"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"destinationFolders"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"./dist"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// 📌 [4] 旧的指定源文件夹方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"sourceFolder"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">".."</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"includeGlobs"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"LICENSE"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>新的：</strong> <code>playground/config/heft.json</code> 中的 <strong>heft.json</strong> 摘录</p><div class="language-ts codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-ts codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://developer.microsoft.com/json-schemas/heft/v0/heft.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"extends"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-web-rig/profiles/library/config/heft.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"phasesByName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ("build" 是用户定义的名称，不是模式字段)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"build"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"tasksByName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ("post-compile-copy" 是用户定义的名称，不是模式字段)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"post-compile-copy"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// 📌 [3] 新的编译后操作方式，通过依赖于相关任务来实现</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// 在 "typescript" 完成后才应运行 "post-compile-copy" 任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"typescript"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"copy-files-plugin"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"options"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-property property" style="color:#36acaa">"copyOperations"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">// 📌 [4] 新的指定源文件夹（或文件路径）的方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token string-property property" style="color:#36acaa">"sourcePath"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">".."</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token string-property property" style="color:#36acaa">"destinationFolders"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"./dist"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token string-property property" style="color:#36acaa">"includeGlobs"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"LICENSE"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>观察：</p><ul><li>这里的更改很小，因为 rig 提供了大部分的构建定义</li><li>最新的 <code>heft-web-rig</code> 使用了 <code>heft-webpack5-plugin</code>，因此我们需要在转换过程中从 Webpack 4 升级到 5</li><li><code>"heftEvent": "compile"</code> 事件不再存在；相反，它必须通过等效的 <code>"taskDependencies"</code> 条目来表示，该条目引用了 rig 的 <code>"typescript"</code> 任务定义</li></ul><h3 class="anchor anchorWithStickyNavbar_abXo" id="迁移pre-compile操作">迁移"pre-compile"操作<a href="#迁移pre-compile操作" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在上面的示例中，我们通过将 <code>"heftEvent": "compile"</code> 替换为 <code>"taskDependencies": ["typescript"]</code> 进行了配置文件的迁移，通过表达在 <code>"typescript"</code> 任务完成之后才能执行该操作。但是 <code>"taskDependencies"</code> 是单向关系。在这种新模型中，我们如何表示诸如 <code>pre-compile</code> 这样的事件呢？</p><p>考虑以下示例：</p><p><strong>旧版:</strong> <strong>heft.json</strong> 样本</p><div class="language-ts codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-ts codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ⚠️ 旧格式示例 -- 请勿使用！⚠️</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://developer.microsoft.com/json-schemas/heft/heft.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"extends"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-web-rig/profiles/app/config/heft.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"eventActions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"actionKind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"copyFiles"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"actionId"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"copyAssets"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 📌 [5] 旧的执行"pre-compile"操作的方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"heftEvent"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pre-compile"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"copyOperations"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"sourceFolder"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"node_modules/some-library/dist"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"destinationFolders"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"temp/typings"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"includeGlobs"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"*.d.ts"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>新版:</strong> <strong>heft.json</strong> 样本</p><div class="language-ts codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-ts codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://developer.microsoft.com/json-schemas/heft/v0/heft.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"extends"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-web-rig/profiles/app/config/heft.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"phasesByName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ("build" 是用户定义的名称，不是模式字段)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"build"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"tasksByName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ("pre-compile-copy" 是用户定义的名称，不是模式字段)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"pre-compile-copy"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"copy-files-plugin"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"options"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-property property" style="color:#36acaa">"copyOperations"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token string-property property" style="color:#36acaa">"sourcePath"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"node_modules/some-library/dist"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token string-property property" style="color:#36acaa">"destinationFolders"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"temp/typings"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token string-property property" style="color:#36acaa">"includeGlobs"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"*.d.ts"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ("typescript" 是用户定义的名称，最初在 rig 中定义)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"typescript"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// 📌 [5] 新的执行"pre-compile"操作的方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// "typescript" 任务在 "pre-compile-copy" 完成之后才能运行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"pre-compile-copy"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>供参考，<code>@rushstack/heft-web-rig</code> 如下定义了 <code>"typescript"</code> 任务：</p><p><a href="https://github.com/microsoft/rushstack/blob/main/rigs/heft-web-rig/profiles/app/config/heft.json" target="_blank" rel="noopener noreferrer">heft-web-rig/profiles/app/config/heft.json</a> 摘录</p><div class="language-js codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-js codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"typescript"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"taskDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"sass"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-typescript-plugin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>观察：</p><ul><li>回想一下，我们通过为自己的任务指定 <code>taskDependencies</code>（<code>"taskDependencies": ["typescript"]</code>）来实现了 <code>"post-compile-copy"</code>。</li><li>相比之下，我们通过修改 rig 的 <code>"typescript"</code> 任务的 <code>taskDependencies</code>（<code>"taskDependencies": ["pre-compile-copy"]</code>）来实现 <code>"pre-compile-copy"</code>。</li><li>rig 已经有 <code>"taskDependencies": ["sass"]</code>。但我们不需要指定 <code>"taskDependencies": ["typescript", "sass"]</code>，因为 Heft 的配置解析器默认会通过追加而不是替换的方式合并数组。</li><li>这种合并行为由 <code>@rushstack/heft-config-file</code> 实现，并且可以使用<a href="/zh-cn/blog/2023/06/15/heft-whats-new/#heftjson-property-inheritance-directives">属性继承指令</a>进行自定义。</li></ul><h2 class="anchor anchorWithStickyNavbar_abXo" id="迁移命令行语法">迁移命令行语法<a href="#迁移命令行语法" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>旧的 <code>--watch</code> 命令行参数已被移除。现在，可以通过在操作名称后附加 <code>-watch</code> 来启用监听模式。</p><p><strong>旧的：</strong></p><div class="language-shell codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-shell codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token plain">heft build --watch --verbose</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>新的：</strong></p><div class="codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-text codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token plain">heft build-watch --verbose</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_abXo" id="命令别名">命令别名<a href="#命令别名" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>在旧的设计中，<code>heft start</code> 是一个特殊操作，用于启动开发服务器。在新的设计中，它是在 <strong>heft.json</strong> 中定义的命令别名。新的别名系统允许您定义自己的自定义别名，以缩短常用命令的长度。</p><p><a href="https://github.com/microsoft/rushstack/blob/main/rigs/heft-web-rig/profiles/app/config/heft.json" target="_blank" rel="noopener noreferrer">heft-web-rig/profiles/app/config/heft.json</a> 摘录</p><div class="language-js codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-js codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 将 "heft start" 定义为 "heft build-watch --serve" 的别名。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"aliasesByName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"start"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"actionName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"build-watch"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"defaultParameters"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"--serve"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>--serve</code> CLI 参数是我们启动<code>localhost</code>开发服务器的标准约定。它被<code>heft-webpack5-plugin</code>和内置的<code>node-service-plugin</code>所支持。</p><h2 class="anchor anchorWithStickyNavbar_abXo" id="迁移自定义插件">迁移自定义插件<a href="#迁移自定义插件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>在更新到新版本的 Heft 时，插件也需要进行兼容性更新。一些较为显著的 API 更改包括：</p><ul><li><strong>heft-plugin.json</strong>清单文件必须随插件包一起提供。如果找不到<strong>heft-plugin.json</strong>文件，Heft 将报告错误。</li><li>插件类必须具有无参数的构造函数，并且必须是<strong>heft-plugin.json</strong>中的<code>entryPoint</code>属性指向的文件的默认导出。</li><li>现在可以使用<strong>heft-plugin.json</strong>中的<code>optionsSchema</code>属性指定在<strong>heft.json</strong>中提供的选项的模式文件，并且 Heft 将对其进行验证。</li><li>参数现在在<strong>heft-plugin.json</strong>中定义，并且通过插件的<code>IHeftTaskSession.parameters</code>或<code>IHeftLifecycleSession.parameters</code>属性来使用。
<em>注意：除了默认的 Heft 参数外，只有调用插件定义的参数是可访问的</em></li><li>插件不再能够定义自己的操作。如果插件需要自己的操作，应将专用阶段添加到消费者的<strong>heft.json</strong>中。</li><li><code>runScript</code> Heft 事件已被修改，仅接受<code>runAsync</code>方法，并且属性已更新以反映常规 Heft 任务插件可用的内容。</li><li>与路径相关的变量已重命名以明确表示它们是路径（例如，<code>HeftConfiguration.buildFolder</code>现在是<code>HeftConfiguration.buildFolderPath</code>）</li><li><code>runIncremental</code>钩子现在可以用于确保按正确的依赖顺序进行监视模式的重建</li><li><code>clean</code>钩子已被删除，以便使用<strong>heft.json</strong>中的<code>cleanFiles</code>选项清除文件，以便明确指定正在清除的文件和时间</li><li>作为后果，插件不再能够以编程方式计算<code>heft clean</code>命令要清除的文件夹；其行为由静态配置文件预先确定，从而使整个系统更简单和更可预测。</li></ul><h2 class="anchor anchorWithStickyNavbar_abXo" id="其他迁移说明">其他迁移说明<a href="#其他迁移说明" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>在<strong>jest.config.json</strong>中，已删除<code>folderNameForTests</code>和<code>extensionForTests</code>属性，应改用<code>testMatch</code>属性处理。</li><li>内置的<code>node-service-plugin</code>现在支持<code>--serve</code>参数，以保持与<code>@rushstack/heft-webpack5-plugin</code>开发服务器的一致性。</li><li>如果指定了<code>--serve</code>并且省略了<code>config/node-service.json</code>，那么<code>node-service-plugin</code>将以硬错误失败。</li><li>尽管<code>@rushstack/heft-lint-plugin</code>和<code>@rushstack/heft-typescript-plugin</code>已分别提取到单独的 NPM 包中，但它们必须</li></ul>]]></content:encoded>
            <category>heft</category>
        </item>
        <item>
            <title><![CDATA[Heft 0.51中的新功能]]></title>
            <link>https://rushstack.io/zh-cn/blog/2023/06/15/heft-whats-new</link>
            <guid>https://rushstack.io/zh-cn/blog/2023/06/15/heft-whats-new</guid>
            <pubDate>Thu, 15 Jun 2023 00:00:00 GMT</pubDate>
            <description><![CDATA["多阶段" Heft 是 @rushstack/heft 项目的一次重大更新，目标是与 Rush 分阶段构建 更紧密地集成。此外，这次更新为 Heft 带来了更大的可定制性和改进的并行处理能力。这篇文章解释了这些改进背后的动机和架构。]]></description>
            <content:encoded><![CDATA[<p>"多阶段" Heft 是 <code>@rushstack/heft</code> 项目的一次重大更新，目标是与 <a href="https://rushjs.io/pages/maintainer/phased_builds/" target="_blank" rel="noopener noreferrer">Rush 分阶段构建</a> 更紧密地集成。此外，这次更新为 Heft 带来了更大的可定制性和改进的并行处理能力。这篇文章解释了这些改进背后的动机和架构。</p><blockquote><p>对于升级指南，请参阅<a href="/zh-cn/blog/2023/06/16/heft-migration-guide/">Heft 0.51 迁移指南</a>文章。</p></blockquote><p>更新版本的 Heft 改进了一些关键领域，包括：</p><ul><li>开发者定义的 Heft 插件和 Heft 事件的执行顺序</li><li>通过<code>--to</code>或<code>--only</code>等范围参数对 Heft 操作的部分执行</li><li>简化的插件 API，方便开发者制作 Heft 插件</li><li>通过<strong>heft-plugin.json</strong>明确定义所有 Heft 插件</li><li>为在一个插件包内定义多个插件提供了原生支持</li><li>改进了插件参数的处理</li><li>在 Heft 操作中提供了对增量观察模式的原生支持</li><li>降低了开销并改进了性能</li><li>还有更多！</li></ul><h2 class="anchor anchorWithStickyNavbar_abXo" id="heft-任务">Heft 任务<a href="#heft-任务" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>Heft 任务是在<strong>heft.json</strong>中指定的最小工作单元。Heft 任务可能依赖于同一阶段内的其他任务，所有任务依赖必须在依赖任务才能执行之前完成执行。</p><p>在过去的版本中，我们区分了内置任务（<code>copy-files-plugin</code>，<code>node-service-plugin</code>等）与从插件包中加载的第三方任务。从 Heft 0.53.0 开始，两种任务现在都以相同的方式声明。内置插件只需为他们的插件<code>packageName</code>指定<code>@rushstack/heft</code>即可。</p><h2 class="anchor anchorWithStickyNavbar_abXo" id="heft-阶段">Heft 阶段<a href="#heft-阶段" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>Heft 阶段定义了在执行该阶段时将运行的一组任务。阶段充当一组逻辑任务的集合，这些任务在合理的情况下（但不一定）映射到<a href="https://rushjs.io/pages/maintainer/phased_builds/" target="_blank" rel="noopener noreferrer">Rush 阶段</a>。Heft 阶段可能依赖于其他阶段，当执行多个阶段时，所有选定的阶段必须完成执行，才能执行依赖的阶段。</p><p><strong>heft.json</strong>文件是定义给定项目或装备的阶段和任务的地方。由于此文件包含阶段和任务之间的关系，因此它定义了执行 Heft 操作的操作顺序。</p><h2 class="anchor anchorWithStickyNavbar_abXo" id="heft-操作">Heft 操作<a href="#heft-操作" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>使用与 Rush 类似的扩展逻辑，可以通过使用<code>heft run</code>操作来执行一组 Heft 阶段。此操作按阶段依赖关系的顺序执行一组选定的阶段。如果选定的阶段互不依赖，那么将并行执行它们。选择参数包括：</p><ul><li><code>--only</code> - 执行指定的阶段</li><li><code>--to</code> - 执行指定的阶段及其所有依赖项</li></ul><p>此外，还可以通过在命令后附加<code>-- &lt;参数&gt;</code>来为<code>heft run</code>操作提供任务和阶段特定的参数。例如，<code>heft run --only build -- --clean</code>将仅运行<code>build</code>阶段，并在执行阶段之前进行清理。</p><p>此外，Heft 将为在<strong>heft.json</strong>配置中指定的每个阶段生成操作。通过运行<code>heft &lt;阶段名称&gt;</code>执行这些操作，并运行 Heft 至指定的阶段，包括所有阶段依赖项。因此，这些推断的 Heft 操作相当于运行<code>heft run --to &lt;阶段名称&gt;</code>，并且旨在作为 CLI 的简写。</p><h2 class="anchor anchorWithStickyNavbar_abXo" id="观察模式">观察模式<a href="#观察模式" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>现在，观察模式已成为 Heft 中的一项一等公民特性。所有的 Heft 操作都创建了观察模式操作。例如，要在观察模式下运行<code>build</code>和<code>test</code>阶段，可以使用<code>heft test-watch</code>或<code>heft run-watch --to test</code>中的任一命令。在观察模式下运行时，Heft 更喜欢<code>runIncremental</code>钩子而非<code>run</code>钩子（参见<a href="#heft%E4%BB%BB%E5%8A%A1%E6%8F%92%E4%BB%B6">Heft 任务插件</a>）。</p><h2 class="anchor anchorWithStickyNavbar_abXo" id="heftjson-结构">heft.json 结构<a href="#heftjson-结构" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>所有阶段都在顶级<code>phasesByName</code>属性内定义。每个阶段可能会指定<code>phaseDependencies</code>，以定义在运行一组 Heft 阶段时的阶段执行顺序。阶段也可以提供<code>cleanFiles</code>选项，该选项接受一个删除操作数组，在使用<code>--clean</code>标志运行时执行。</p><p>在阶段规格中，<code>tasksByName</code> 定义了执行阶段时运行的所有任务。每个任务可能会指定 <code>taskDependencies</code> 来定义任务执行的顺序。（如果省略了 <code>taskDependencies</code>，则默认为 []，并且任务只等待包含阶段的任何 <code>phaseDependencies</code>。）<code>taskDependencies</code> 中定义的所有任务必须存在于同一阶段。由于 CLI 可用性的原因，阶段名、任务名、插件名和参数范围，必须是 <code>kebab-cased</code>。</p><p>以下是一个定义了<code>build</code>和<code>test</code>阶段的"heft.json"文件示例：</p><p><strong>heft.json</strong>定义阶段和任务的示例</p><div class="language-js codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-js codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://developer.microsoft.com/json-schemas/heft/v0/heft.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"extends"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"base-project/config/heft.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// "phasesByName"定义了所有阶段，每个阶段定义了要运行的任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"phasesByName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ("build"是用户定义的名称，不是模式字段)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"build"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"phaseDescription"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"对构建输出进行转译并运行一个语法检查器"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"cleanFiles"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"sourcePath"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"temp-build-output"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// "tasksByName"定义了阶段内的所有任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"tasksByName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ("typescript"是用户定义的名称，不是模式字段)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"typescript"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-typescript-plugin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"lint"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"typescript"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-lint-plugin"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"eslint"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"copy-assets"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"copy-files-plugin"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"options"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-property property" style="color:#36acaa">"copyOperations"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">// 注意：在之前的HEFT版本中，这被称为"sourceFolder"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token string-property property" style="color:#36acaa">"sourcePath"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"src/assets"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token string-property property" style="color:#36acaa">"destinationFolders"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dist/assets"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ("test"是用户定义的名称，不是模式字段)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"test"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"phaseDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"build"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"phaseDescription"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"运行Jest测试，如果提供的话。"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"tasksByName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ("jest"是用户定义的名称，不是模式字段)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"jest"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">"taskPlugin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-jest-plugin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生命周期插件在顶层的<code>heftPlugins</code>数组中指定。插件可以通过提供包名和插件名来引用。另外，如果一个包只包含一个插件，插件可以通过仅提供包名来引用，Heft 将解析为唯一导出的插件。生命周期插件也可以提供选项来修改默认行为。</p><p><strong>heft.json</strong>加载生命周期插件的示例</p><div class="language-js codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-js codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://developer.microsoft.com/json-schemas/heft/v0/heft.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"extends"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"base-project/config/heft.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"heftPlugins"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-metrics-reporter"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"options"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"disableMetrics"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"pluginPackage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@rushstack/heft-initialization-plugin"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"pluginName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-lifecycle-plugin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// (此处也可以出现"phasesByName"部分)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_abXo" id="heftjson-属性继承指令">heft.json 属性继承指令<a href="#heftjson-属性继承指令" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以前，<strong>heft.json</strong> 文件与其扩展的基本文件之间的共享属性将合并数组和覆盖对象。现在，数组和对象都将合并，当自定义扩展基本配置时，简化了<strong>heft.json</strong>文件的使用。</p><p>另外，配置文件解析器现在支持<strong>属性继承指令</strong>，用于自定义在使用<code>"extends"</code>继承时 JSON 属性如何合并。这个系统由 <a href="https://www.npmjs.com/package/@rushstack/heft-config-file" target="_blank" rel="noopener noreferrer">@rushstack/heft-config-file</a> 库实现，并适用于所有使用该解析器加载的配置文件。覆盖是通过使用定义继承行为的指令来指定的。</p><p>例如，假设我们正在扩展一个文件，该文件具有预先定义的<code>exampleObject</code>值（一个键对象）和<code>exampleArray</code>值（一个数组对象）：</p><div class="language-js codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-js codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://developer.microsoft.com/json-schemas/heft/v0/example-config-file.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"extends"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"base-project/config/example-config-file.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"$exampleObject.inheritanceType"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"merge"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 有效选择为："merge", "replace"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"exampleObject"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"$exampleObjectMember.inheritanceType"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"merge"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 有效选择为："merge", "replace"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"exampleObjectMember"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"$exampleArrayMember.inheritanceType"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"append"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 有效选择为："append", "replace"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"exampleArrayMember"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"$exampleArray.inheritanceType"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"replace"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 有效选择为："append", "replace"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"exampleArray"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>一旦对象被设置为覆盖的<code>inheritanceType</code>，所有子属性的<code>inheritanceType</code>值将被忽略，因为最顶层的对象已经覆盖了所有子属性。</p><p>需要注意的一点是，合并键对象和数组时使用了不同的<code>mergeBehavior</code>动词。这是为了明确表示数组将按原样追加，合并过程中不进行任何额外处理（例如，如果数组应该是一组，那么不进行重复）。如果需要这样的行为，可以在实现端完成。在<code>@rushstack/heft-config-file</code>包中对数组进行重复处理没有什么意义，因为对非基元对象的数组进行重复处理并不容易定义。</p><h2 class="anchor anchorWithStickyNavbar_abXo" id="关联的-npm-包">关联的 NPM 包<a href="#关联的-npm-包" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>许多以前内置于 Heft 的任务现已被拆分到单独的 NPM 包中。完整列表如下：</p><ul><li><code>@rushstack/heft</code></li><li><code>@rushstack/heft-typescript-plugin</code></li><li><code>@rushstack/heft-lint-plugin</code></li><li><code>@rushstack/heft-api-extractor-plugin</code></li><li><code>@rushstack/heft-jest-plugin</code></li><li><code>@rushstack/heft-sass-plugin</code></li><li><code>@rushstack/heft-storybook-plugin</code></li><li><code>@rushstack/heft-webpack4-plugin</code></li><li><code>@rushstack/heft-webpack5-plugin</code></li><li><code>@rushstack/heft-dev-cert-plugin</code></li></ul><p>此外，Rushstack 提供的 rigs 已更新以与新版本的 Heft 兼容：</p><ul><li><code>@rushstack/heft-node-rig</code></li><li><code>@rushstack/heft-web-rig</code></li></ul><h2 class="anchor anchorWithStickyNavbar_abXo" id="编写-heft-插件">编写 Heft 插件<a href="#编写-heft-插件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_abXo" id="生命周期插件">生命周期插件<a href="#生命周期插件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Heft 生命周期插件为某些与生命周期相关的钩子提供实现。这些插件将在所有 Heft 阶段中使用，因此除了少数特定情况（如用于指标报告）之外，应很少在外部使用。Heft 生命周期插件提供一个 <code>apply()</code> 方法，插件可以在此处挂载以下 Tapable 钩子：</p><ul><li><code>toolStart</code> - 在 Heft 执行开始时提供与插件相关的功能</li><li><code>toolFinish</code> - 在所有任务完成后，在 Heft 执行结束时提供与插件相关的功能</li><li><code>recordMetrics</code> - 在所有任务完成后，向插件提供有关 Heft 运行的指标信息</li></ul><h3 class="anchor anchorWithStickyNavbar_abXo" id="任务插件">任务插件<a href="#任务插件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Heft 任务插件为 Heft 任务提供实现。Heft 插件提供一个 <code>apply()</code> 方法，插件可以在此处挂载以下 Tapable 钩子：</p><ul><li><code>registerFileOperations</code> - 在插件首次运行前确切地调用一次。允许插件使用与 <code>copyFiles</code> 和 <code>deleteFiles</code> Heft 事件相同的选项注册复制或删除操作（这个钩子就是实现这些事件的方式）。</li><li><code>run</code> - 提供与插件相关的任务功能</li><li><code>runIncremental</code> - 在观察模式下提供与插件相关的任务功能。如果没有为任务提供 <code>runIncremental</code> 实现，Heft 将像往常一样回退到使用 <code>run</code> 钩子。选项结构包括两个用于支持观察操作的函数：<ul><li><code>requestRun()</code> - 这个函数请求 Heft 运行时安排插件所属任务的新运行，可能会取消当前的构建。</li><li><code>watchGlobAsync(patterns, options)</code> - 这个函数是为了方便常见的监视 glob 变化的情况而提供的。它返回一个 <code>Map&lt;string, IWatchedFileState&gt;</code>，该映射枚举了 glob 选定的文件（或文件夹）列表，以及它们自</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_abXo" id="heft-pluginjson">heft-plugin.json<a href="#heft-pluginjson" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><strong>heft-plugin.json</strong> 配置文件是一个新的，必需的清单文件，所有 Heft 插件包的包文件夹中都必须存在。此文件用于多种用途，包括定义所有包含的生命周期或任务插件，定义所有插件特定的 CLI 参数，并提供一个可选的模式文件，以验证可以通过 <strong>heft.json</strong> 传递的插件选项。</p><p>以下是定义生命周期插件和任务插件的示例 <strong>heft-plugin.json</strong> 文件：</p><div class="language-json codeBlockContainer_wfCu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_iwbS"><pre tabindex="0" class="prism-code language-json codeBlock_P4EJ thin-scrollbar"><code class="codeBlockLines_armO"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://developer.microsoft.com/json-schemas/heft/v0/heft-plugin.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"lifecyclePlugins"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"pluginName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-lifecycle-plugin"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"entryPoint"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./lib/MyLifecyclePlugin.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"optionsSchema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./lib/schemas/mylifecycleplugin.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"parameterScope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-lifecycle"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"parameters"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"parameterKind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"longName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"--my-string"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"…"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"argumentName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ARG_NAME"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"required"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"taskPlugins"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"pluginName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-task-plugin"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"entryPoint"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./lib/MyTaskPlugin.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"optionsSchema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./lib/schemas/mytaskplugin.schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"parameterScope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-task"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"parameters"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"parameterKind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"longName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"--my-other-string"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"…"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"argumentName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ARG_NAME"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"required"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_WJX8"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_A4mn" aria-hidden="true"><svg class="copyButtonIcon_zOh6" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_kaU6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_abXo" id="跨插件交互">跨插件交互<a href="#跨插件交互" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>有时插件之间的交流会很有帮助。例如，<code>@rushstack/heft-lint-plugin</code> 和 <code>@rushstack/heft-typescript-plugin</code> 共享一个 TypeScript 的 <code>ts.Program</code> 对象，这极大地提高了构建时间，因为避免了两次计算编译器的语义分析。这种优化带来了一个约束，那就是任务必须在您的 <strong>heft.json</strong> 配置中共享同一个 Heft 阶段。</p><p>这是如何工作的？Heft 插件可以使用 <code>requestAccessToPluginByName()</code> API 来访问请求的 <strong>插件访问器</strong>。访问器是插件提供给外部使用的对象，是分享插件特定信息或提供额外插件功能的钩子的理想位置。</p><p>在阶段执行开始时，清理钩子执行之前，满足访问请求。如果请求的插件没有提供访问器，将抛出一个错误，指出缺少访问器的插件。然而，如果完全没有请求的插件，访问请求将默默地失败。这样做是为了允许对外部插件进行非必需的集成。因此，实现跨插件交互的方式很重要，以期望这种情况，并优雅地处理，或者抛出一个有帮助的错误。</p><p>可访问的插件基于范围进行限制。对于生命周期插件，您可以请求访问添加到 Heft 配置中的任何其他生命周期插件。对于任务插件，您可以请求访问 Heft 配置中相同阶段内的任何其他任务插件。</p><h3 class="anchor anchorWithStickyNavbar_abXo" id="自定义-cli-参数">自定义 CLI 参数<a href="#自定义-cli-参数" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>现在，只能通过 <strong>heft-plugin.json</strong> 定义 CLI 参数，而定义的参数可以通过 <code>HeftTaskSession.parameters</code> API 在插件中使用。此外，当使用 <code>--help</code> 参数（例如 <code>heft test --help</code> 或 <code>heft run --to test -- --help</code>）时，现在可以在 CLI 中发现选定的 Heft 阶段的所有插件参数。</p><p>这些参数可以使用可选提供的 <code>parameterScope</code> 在 CLI 上自动进行 "去重"。默认情况下，<strong>heft-plugin.json</strong> 中定义的参数将使用 <code>--&lt;parameterName&gt;</code> 和 <code>--&lt;parameterScope&gt;:&lt;parameterName&gt;</code> 在 CLI 上可用。当多个插件提供相同的参数时，为了 "去重" 冲突的参数，只有后者参数在 CLI 上可用。例如，如果 PluginA 具有参数范围 "PluginA" 定义 <code>--parameter</code>，并且 PluginB 也使用参数范围 "PluginB" 定义 <code>--parameter</code>，那么参数 <em>只能</em> 作为 <code>--PluginA:parameter</code> 和 <code>--PluginB:parameter</code> 可用。</p><p>如果您对这些对 Heft 的更改有任何问题或反馈，请<a href="https://rushstack.zulipchat.com/#narrow/stream/262522-heft" target="_blank" rel="noopener noreferrer">在聊天室中提问</a>或<a href="https://github.com/microsoft/rushstack/issues/new?assignees=&amp;labels=&amp;template=heft.md&amp;title=%5Bheft%2Frc%2f0%5D+" target="_blank" rel="noopener noreferrer">提交一个问题</a>。</p>]]></content:encoded>
            <category>heft</category>
        </item>
        <item>
            <title><![CDATA[关于Rush Stack博客]]></title>
            <link>https://rushstack.io/zh-cn/blog/2023/06/01/blog-launch</link>
            <guid>https://rushstack.io/zh-cn/blog/2023/06/01/blog-launch</guid>
            <pubDate>Thu, 01 Jun 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[欢迎来到Rush Stack 博客！我们新设立了这个网站板块，用于分享关于 Rush Stack 项目的新闻和见解。]]></description>
            <content:encoded><![CDATA[<p>欢迎来到<strong>Rush Stack 博客</strong>！我们新设立了这个网站板块，用于分享关于 Rush Stack 项目的新闻和见解。</p><p>我们会在<a href="https://twitter.com/rushstack" target="_blank" rel="noopener noreferrer">Twitter</a>
和<a href="https://fosstodon.org/@rushstack" target="_blank" rel="noopener noreferrer">Mastodon</a>上发布新博客文章的公告。您也可以直接订阅博客的
<a href="/zh-cn/blog/rss.xml/">RSS</a>或者<a href="/zh-cn/blog/atom.xml/">Atom</a>源。</p><p>而网站文档主要是参考资料，博客主题可能包括：</p><ul><li>公告详情</li><li>主要更改的解释</li><li>尝试技术的提示</li><li>最佳实践</li><li>想法和分析</li></ul><p>如果您想贡献一篇博客文章或者帮助我们的翻译工作，请联系<a href="https://github.com/octogonz" target="_blank" rel="noopener noreferrer">@octogonz</a>。</p>]]></content:encoded>
        </item>
    </channel>
</rss>